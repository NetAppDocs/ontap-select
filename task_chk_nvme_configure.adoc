---
sidebar: sidebar
permalink: task_chk_nvme_configure.html
keywords: ontap select, nvme storage, host preparation
summary: If you plan to use NVMe drives with software RAID, you need to configure the host to recognize the drives.
---
= Configure an ONTAP Select host to use NVMe drives
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
If you plan to use NVMe drives with software RAID, you need to configure the ESXi or KVM host to recognize the drives.

Use VMDirectPath I/O Pass-through on the NVMe devices to maximize data efficiency. This setting exposes the drives to the ONTAP Select virtual machine, allowing ONTAP to have direct PCI access to the device.

== Step 1: Configure the host
Configure the ESXi or KVM host to recognize the drives.

.Before you begin

Make sure your deployment environment meets the following minimum requirements:

* For an ESXi host, ONTAP Select 9.7 or later with a supported Deploy administration utility
* For a KVM host, ONTAP Select 9.17.1 or later with a supported Deploy administration utility
* Premium XL platform license offering or a 90-day evaluation license
* The ESXi or KVM host is running a supported hypervisor version:
+
[role="tabbed-block"]
=====

.ESXi
--
ESXi is supported on the following hypervisor versions:

* VMware ESXi 9.0
* VMware ESXi 8.0 U3
* VMware ESXi 8.0 U2
* VMware ESXi 8.0 U1 (build 21495797)
* VMware ESXi 8.0 GA (build 20513097)
--

.KVM
--
KVM is supported on the following hypervisor versions:

* Red Hat Enterprise Linux (RHEL) 10.1, 10.0, 9.7, 9.6, 9.5, 9.4, 9.2, 9.1, 9.0, 8.8, 8.7, and 8.6
* Rocky Linux 10.0, 9.6, 9.5, 9.4, 9.3, 9.2, 9.1, 9.0, 8.9, 8.8, 8.7, and 8.6

include::./_include/rhel-and-rockylinux10-rl-support.adoc[]
--
=====

* NVMe devices conforming to specification 1.0 or later

Follow the link:kvm-host-configuration-and-preparation-checklist[host preparation checklist], and review the required information for the link:reference_chk_deploy_req_info.html[deploy utility installation] and the link:reference_chk_select_req_info.html[ONTAP Select installation] for more information.

.About this task

You must perform this procedure before creating a new ONTAP Select cluster. You can also perform the procedure to configure additional NVMe drives for an existing software RAID NVMe cluster. In this case, after configuring the drives, you must add them through Deploy as you would additional SSD drives. The main difference is that Deploy detects the NVMe drives and reboots the nodes. When adding NVMe drives to an existing cluster, note the following about the reboot process:

* Deploy handles the reboot orchestration.
* HA takeover and giveback is performed in an orderly fashion, but it can be time consuming to resynchronize the aggregates.
* A single-node cluster will incur downtime.

See link:concept_stor_capacity_inc.html[Increase storage capacity] for additional information.

.Steps

. Access the *BIOS configuration* menu on the host to enable support for I/O virtualization.

. Enable the *Intel VT for Directed I/O (VT-d)* setting.
+
image:nvme_01.png[Socket Configuration]

. Some servers offer support for *Intel Volume Management Device (Intel VMD)*. When enabled, this makes the available NVMe devices invisible to the ESXi or KVM hypervisor; disable this option before proceeding.
+
image:nvme_07.png[Socket Configuration, VMD]

. Configure the NVMe drives for pass-through to virtual machines.

.. In vSphere, open the host *Configure* view and select *Edit* under *Hardware: PCI devices*.

.. Select the NVMe drives you want to use for ONTAP Select.
+
The following example output shows the available drives for an ESXi host:
+
image:nvme_02.png[Edit PCI Device Availability]
+
[NOTE]
You need a VMFS datastore that is also backed by an NVMe device to host the ONTAP Select VM system disks and virtual NVRAM. Leave at least one NVMe drive available for this purpose when configuring the others for PCI pass-through.

.. Select *OK*. The selected devices indicate *Available (pending)*.

. Select *Reboot This Host*.
+
The following example output is for an ESXi host:
+
image:nvme_03.png[Reboot This Host]

== Step 2: Install the ONTAP Select Deploy utility

After the hosts are prepared, you can install the ONTAP Select Deploy utility. Deploy guides you through creating ONTAP Select storage clusters on your newly prepared hosts. During this process, Deploy detects the presence of the NVMe drives configured for pass-through and automatically selects them for use as ONTAP data disks. You can adjust the default selection if needed.

[NOTE]
A maximum of 14 NVMe devices are supported for each ONTAP Select node.

The following example output is for an ESXi host:

image:nvme_04.png[ONTAP Select Deploy Clusters]

After the cluster is successfully deployed, ONTAP System Manager allows you to provision the storage according to best practices. ONTAP automatically enables flash-optimized storage efficiency features that make the best use of your NVMe storage.

image:nvme_05.png[preparing local storage]

image:nvme_06.png[ONTAP System Manager]

// 2025 DEC 9. ONTAPDOC-3461
// 2025 July 17, ONTAPDOC-2885 